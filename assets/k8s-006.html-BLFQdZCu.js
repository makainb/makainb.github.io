import{_ as s,c as a,a as n,o as l}from"./app-BZ33XHo8.js";const i={};function t(r,e){return l(),a("div",null,e[0]||(e[0]=[n(`<h2 id="网络插件-calico" tabindex="-1"><a class="header-anchor" href="#网络插件-calico"><span>网络插件 Calico</span></a></h2><p>master-01 切换到版本对应的分支</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">cd /root/k8s-ha-install &amp;&amp; git checkout manual-installation-v1.28.x &amp;&amp; cd calico/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>master-01 替换POD网段</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token assign-left variable">POD_SUBNET</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">cat</span> /etc/kubernetes/manifests/kube-controller-manager.yaml <span class="token operator">|</span> <span class="token function">grep</span> cluster-cidr<span class="token operator">=</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span><span class="token operator">=</span> <span class="token string">&#39;{print $NF}&#39;</span><span class="token variable">\`</span></span></span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s#POD_CIDR#<span class="token variable">\${POD_SUBNET}</span>#g&quot;</span> calico.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>应用calico插件</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">kubectl apply -f calico.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>验证-查看calico的pod状态</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line"># 所有的Running就是完成</span>
<span class="line">kubectl get po -n kube-system</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>验证-查看master和node的状态</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line"># 所有的Ready就是完成</span>
<span class="line">kubectl get node </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="资源采集-metrics" tabindex="-1"><a class="header-anchor" href="#资源采集-metrics"><span>资源采集 Metrics</span></a></h2><p>Master-01节点的front-proxy-ca.crt复制到所有Node节点</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">for i in k8s-node-01 k8s-node-02;do scp /etc/kubernetes/pki/front-proxy-ca.crt $i:/etc/kubernetes/pki/front-proxy-ca.crt;done</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>master-01 安装</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">cd /root/k8s-ha-install/kubeadm-metrics-server</span>
<span class="line">kubectl create -f comp.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>master-01 查看状态</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line"># 出现running就是成功</span>
<span class="line">kubectl get po -n kube-system -l k8s-app=metrics-server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>验证</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 查看node负载</span></span>
<span class="line">kubectl <span class="token function">top</span> <span class="token function">node</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看pod负载</span></span>
<span class="line">kubectl <span class="token function">top</span> pod <span class="token parameter variable">-A</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="web控制台-dashboard" tabindex="-1"><a class="header-anchor" href="#web控制台-dashboard"><span>Web控制台 Dashboard</span></a></h2><p>安装 dashboard</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">cd /root/k8s-ha-install/dashboard/</span>
<span class="line">kubectl create -f .</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>找到端口所在的NodePort</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line">kubectl get all -n  kubernetes-dashboard</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>打开网址（需要Token）：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="language-text"><code><span class="line"># master-01所在的IP ：NodePort的端口</span>
<span class="line">https://192.168.0.201:32737/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>创建Token</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ kubectl create token admin-user <span class="token parameter variable">-n</span> kube-system</span>
<span class="line"></span>
<span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6IldWRVRVWDE3SlZxM0NxVEFVQzVwQm5rQ3BJeHdIZ3AwTHE2SDJaT1lYbEUifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzIxMDYxNjQ2LCJpYXQiOjE3MjEwNTgwNDYsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJhZG1pbi11c2VyIiwidWlkIjoiY2ZmZGYyZWMtZDlmZC00NWE2LTliYmUtMTJiYjg2Y2E1ZDA5In19LCJuYmYiOjE3MjEwNTgwNDYsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlLXN5c3RlbTphZG1pbi11c2VyIn0.GZeXtkyLBzYvxf-MQSqRNxFCctqu0kYtNZET1qn950kY8Xo3L09Uyzd1_K_Z_vLAN5gWaH5vRgRAMsoZEThz0lW5qaLSGxNOhLVkJF8PrDZzJRpNbB7COTdJHJG6HUUQGSwS7TB0_UnyS2TZZgZfIDCTYJq8ZaW7T4lM6U80Cmk91KU1WRZQsh1zdJr0w2OozXgOsUkQ8Dd62EqxpFMi6dRB2s3y2UAsfPKjSAfUyGxH731Sc4_te3kfuwCDxcp876wygXN--_LSf5rQfIL1mUaHzjtjmnamN85sF8I3HpwbPJeibI_7aGj4G8KOV_crLCyjdbh5ODgKpgc7yoCYCg</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="高级界面-krm" tabindex="-1"><a class="header-anchor" href="#高级界面-krm"><span>高级界面 KRM</span></a></h2><p>打开github https://github.com/dotbalo/krm/blob/main/deploy.md</p>`,31)]))}const c=s(i,[["render",t],["__file","k8s-006.html.vue"]]),p=JSON.parse('{"path":"/docs/ops/k8s-006.html","title":"k8s-006-插件安装","lang":"en-US","frontmatter":{"title":"k8s-006-插件安装","date":"2024/07/15"},"headers":[{"level":2,"title":"网络插件 Calico","slug":"网络插件-calico","link":"#网络插件-calico","children":[]},{"level":2,"title":"资源采集 Metrics","slug":"资源采集-metrics","link":"#资源采集-metrics","children":[]},{"level":2,"title":"Web控制台 Dashboard","slug":"web控制台-dashboard","link":"#web控制台-dashboard","children":[]},{"level":2,"title":"高级界面 KRM","slug":"高级界面-krm","link":"#高级界面-krm","children":[]}],"git":{"createdTime":1721062027000,"updatedTime":1721062027000,"contributors":[{"name":"makai","email":"makai3@126.com","commits":1}]},"filePathRelative":"docs/ops/k8s-006.md"}');export{c as comp,p as data};
